{% extends "property/base.html" %}
{% load static %}

{% block content %}
  {% include "property/sidebar.html" %}
  <div class="main-panel">
    <div class="main-header">
      <div class="main-header-logo">
        <div class="logo-header" data-background-color="dark">
          <a href="index.html" class="logo">
            <img
              src="{% static 'customer/img/logo.png' %}"
              alt="navbar brand"
              class="navbar-brand"
              height="20"
            />
          </a>
          <div class="nav-toggle">
            <button class="btn btn-toggle toggle-sidebar"><i class="gg-menu-right"></i></button>
            <button class="btn btn-toggle sidenav-toggler"><i class="gg-menu-left"></i></button>
          </div>
          <button class="topbar-toggler more"><i class="gg-more-vertical-alt"></i></button>
        </div>
      </div>
      {% include "property/nav.html" %}
    </div>

    <div class="container">
      <div class="page-inner">
        <div class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4">
          <div></div>
        </div>

        <h2 class="mb-4">My Residence Properties</h2>

        <div class="table-responsive">
          <table class="table table-hover align-middle table-transparent">
            <thead class="text-uppercase text-secondary small">
              <tr>
                <th>Property Name</th>
                <th>Property Type</th>
                <th>District</th>
                <th>Region</th>
                <th>Country</th>
                <th>Status</th>
                <th>Created At</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for property in properties %}
              <tr class="align-middle">
                <td class="fw-bold">{{ property.property_name }}</td>
                <td>{{ property.property_type|title }}</td>
                <td>{{ property.district }}</td>
                <td>{{ property.region }}</td>
                <td>{{ property.country }}</td>
                <td>
                  {% if property.status == 'open' %}
                    <span class="badge bg-success">Open</span>
                  {% elif property.status == 'hold' %}
                    <span class="badge bg-warning text-dark">Hold</span>
                  {% elif property.status == 'closed' %}
                    <span class="badge bg-danger">Closed</span>
                  {% else %}
                    <span class="badge bg-secondary">{{ property.status }}</span>
                  {% endif %}
                </td>

                <td>{{ property.created_at }}</td>

                <td class="d-flex gap-1">

                  <!-- View button -->
                  <a href="{% url 'residence_property_detail' property.id %}" class="btn btn-sm btn-primary">
                    <i class="bi bi-eye"></i>
                  </a>

                  <!-- Update Button -->
                  <button class="btn btn-sm btn-warning" data-bs-toggle="modal"
                          data-bs-target="#statusModal{{ property.id }}">
                    <i class="bi bi-pencil-square"></i>
                  </button>

                  <!-- Delete -->
                  <form action="{% url 'residence_property_delete' property.id %}" method="POST"
                        onsubmit="return confirm('Are you sure you want to delete this property?');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-danger">
                      <i class="bi bi-trash"></i>
                    </button>
                  </form>

                </td>
              </tr>

              <!-- STATUS UPDATE MODAL -->
              <div class="modal fade" id="statusModal{{ property.id }}" tabindex="-1">
                <div class="modal-dialog">
                  <div class="modal-content">

                    <div class="modal-header">
                      <h5 class="modal-title">Update Status: {{ property.property_name }}</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <form method="POST" action="{% url 'update_residence_status' property.id %}">
                      {% csrf_token %}
                      <div class="modal-body">
                        <label class="form-label">Select Status</label>
                        <select name="status" class="form-select" required>
                          <option value="open" {% if property.status == 'open' %}selected{% endif %}>Open</option>
                          <option value="hold" {% if property.status == 'hold' %}selected{% endif %}>Hold</option>
                          <option value="closed" {% if property.status == 'closed' %}selected{% endif %}>Closed</option>
                        </select>
                      </div>

                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Update</button>
                      </div>
                    </form>

                  </div>
                </div>
              </div>

              {% empty %}
              <tr>
                <td colspan="7" class="text-center text-muted">No properties found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>

  <style>
/* Transparent table with visible borders */
.table-transparent {
  background: transparent !important;
  border-collapse: collapse;
  width: 100%;
  min-width: 700px;
}
.table-transparent th,
.table-transparent td {
  background: transparent !important;
  color: #000;
  border: 1px solid rgba(0,0,0,0.1);
  padding: 0.5rem 0.75rem;
  text-align: left;
  white-space: nowrap;
}
.table-transparent thead th {
  border-bottom: 2px solid rgba(0,0,0,0.15);
}
.table-hover tbody tr:hover {
  background-color: rgba(0, 102, 255, 0.05);
  transition: 0.2s;
}

.btn-primary, .btn-danger, .btn-warning {
  font-size: 0.85rem;
  padding: 0.35rem 0.65rem;
}

/* Responsive Fix â€” Keep Buttons in One Row */
@media (max-width: 768px) {

  /* Keep buttons in one row */
  td.d-flex.gap-1 {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    justify-content: flex-start !important;
    align-items: center !important;
    gap: 0.35rem !important;
    white-space: nowrap !important; /* VERY IMPORTANT */
  }

  /* Prevent table cells from breaking layout */
  .table-transparent td {
    white-space: nowrap !important;
  }
}

  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">


{% endblock %}
