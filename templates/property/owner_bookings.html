{% extends "property/base.html" %}
{% load static %}
{% load humanize %}

{% block content %}
  {% include "property/sidebar.html" %}
  <div class="main-panel">
    <div class="main-header">
      <div class="main-header-logo">
        <div class="logo-header" data-background-color="dark">
          <a href="index.html" class="logo">
            <img
              src="{% static 'customer/img/logo.png' %}"
              alt="navbar brand"
              class="navbar-brand"
              height="20"
            />
          </a>
          <div class="nav-toggle">
            <button class="btn btn-toggle toggle-sidebar"><i class="gg-menu-right"></i></button>
            <button class="btn btn-toggle sidenav-toggler"><i class="gg-menu-left"></i></button>
          </div>
          <button class="topbar-toggler more"><i class="gg-more-vertical-alt"></i></button>
        </div>
      </div>
      {% include "property/nav.html" %}
    </div>

    <div class="container">
      <div class="page-inner">
        <div class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4">
          <div></div>
        </div>

        <h2 class="mb-4">Bookings for Your Properties</h2>
        <p>Track all bookings made by customers for your listed properties.</p>

        <div class="table-responsive">
          <table class="table table-hover align-middle table-transparent">
            <thead class="text-uppercase text-secondary small">
              <tr>
                <th>Booking ID</th>
                <th>Property</th>
                <th>Customer</th>
                <th>Total Cost</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for booking in bookings %}
              <tr class="align-middle">
                <td class="fw-bold">ST-B-{{ booking.id|stringformat:"04d" }}</td>
                <td>{{ booking.property.property_name }}</td>
                <td>{{ booking.user.first_name }} {{ booking.user.last_name }}</td>
                <td>{{ booking.total_price|intcomma }} TZS</td>
                <td>
                  {% if booking.status == 'pending' %}
                    <span class="badge bg-warning">{{ booking.status|title }}</span>
                  {% elif booking.status == 'confirmed' %}
                    <span class="badge bg-success">{{ booking.status|title }}</span>
                  {% elif booking.status == 'cancelled' %}
                    <span class="badge bg-danger">{{ booking.status|title }}</span>
                  {% elif booking.status == 'completed' %}
                    <span class="badge bg-primary">{{ booking.status|title }}</span>
                  {% else %}
                    <span class="badge bg-secondary">{{ booking.status|title }}</span>
                  {% endif %}
                </td>
                <td class="d-flex gap-1">
                  <a href="{% url 'owner_booking_detail' booking.id %}" class="btn btn-sm btn-primary">View Details</a>

                  <!-- Update Booking Status Modal Button -->
                  <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#statusModal{{ booking.id }}">
                    <i class="bi bi-pencil-square"></i>Verify Booking
                  </button>
                </td>
              </tr>

              <!-- STATUS UPDATE MODAL -->
              <div class="modal fade" id="statusModal{{ booking.id }}" tabindex="-1">
                <div class="modal-dialog">
                  <div class="modal-content">

                    <div class="modal-header">
                      <h5 class="modal-title">Update Status: ST-B-{{ booking.id|stringformat:"04d" }}</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <form method="POST" action="{% url 'update_booking_status' booking.id %}">
                      {% csrf_token %}
                      <div class="modal-body">
                        <label class="form-label">Select Status</label>
                        <select name="status" class="form-select" required>
                          <option value="pending" {% if booking.status == 'pending' %}selected{% endif %}>Pending</option>
                          <option value="confirmed" {% if booking.status == 'confirmed' %}selected{% endif %}>Confirmed</option>
                          <option value="cancelled" {% if booking.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
                          <option value="completed" {% if booking.status == 'completed' %}selected{% endif %}>Completed</option>
                        </select>
                      </div>

                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Update</button>
                      </div>
                    </form>

                  </div>
                </div>
              </div>

              {% empty %}
              <tr>
                <td colspan="6" class="text-center text-muted">No bookings found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>

  <style>
/* Transparent table with visible borders */
.table-transparent {
  background: transparent !important;
  border-collapse: collapse;
  width: 100%;
  min-width: 700px;
}
.table-transparent th,
.table-transparent td {
  background: transparent !important;
  color: #000;
  border: 1px solid rgba(0,0,0,0.1);
  padding: 0.5rem 0.75rem;
  text-align: left;
  white-space: nowrap;
}
.table-transparent thead th {
  border-bottom: 2px solid rgba(0,0,0,0.15);
}
.table-hover tbody tr:hover {
  background-color: rgba(0, 102, 255, 0.05);
  transition: 0.2s;
}

.btn-primary, .btn-danger, .btn-warning {
  font-size: 0.85rem;
  padding: 0.35rem 0.65rem;
}

/* Responsive Fix â€” Keep Buttons in One Row */
@media (max-width: 768px) {
  td.d-flex.gap-1 {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    justify-content: flex-start !important;
    align-items: center !important;
    gap: 0.35rem !important;
    white-space: nowrap !important;
  }
  .table-transparent td {
    white-space: nowrap !important;
  }
}
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

{% endblock %}
